surpi_db=config["surpi_database"]
singularity_image_path=config["surpi_image"]

rule all_surpi_db:
    input: f"{surpi_db}/ncbi/fasta/taxdump.tar.gz"



rule clone_surpi_repo:
    output: f"{surpi_db}/Makefile"

    params: DB_path=surpi_db

    shell:
        """
        git clone https://github.com/chiulab/SURPI-plus-dist.git
        cp -r SURPI-plus-dist/etc/reference/* {params}
        """

rule build_surpi_database:
    input: f"{surpi_db}/Makefile"

    output: f"{surpi_db}/ncbi/fasta/taxdump.tar.gz"

    params: DB_path=surpi_db,
            img_path=singularity_image_path

    shell:
        """
        singularity exec --app SURPI --bind {params.DB_path} {params.img_path} bash -c "make -C {params.DB_path} all"
        """
