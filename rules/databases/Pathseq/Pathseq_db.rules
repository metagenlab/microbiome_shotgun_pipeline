db_path=config["pathseq_database"]
rule all_PathseqDB:
    input: f"{db_path}/pathseq_host.fa.fai",
           f"{db_path}/pathseq_host.fa",
           f"{db_path}/pathseq_host.bfi",
           f"{db_path}/pathseq_host.fa.img",
           f"{db_path}/pathseq_host.dict",
           f"{db_path}/pathseq_microbe.fa.fai",
           f"{db_path}/pathseq_microbe.fa",
           f"{db_path}/pathseq_microbe.fa.img",
           f"{db_path}/pathseq_microbe.dict",
           f"{db_path}/pathseq_taxonomy.db"


rule download_Pathseq_DB_from_ftp:
    output: f"{db_path}/pathseq_{{filename}}.tar.gz",

    params: dir=db_path

    shell:
        """
        wget ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/pathseq/{wildcards.filename}.gz -P {params.dir}
        """

rule decompress_host_DB:
    input: f"{db_path}/pathseq_host.tar.gz"

    output: f"{db_path}/pathseq_host.fa.fai",
            f"{db_path}/pathseq_host.fa",
            f"{db_path}/pathseq_host.bfi",
            f"{db_path}/pathseq_host.fa.img",
            f"{db_path}/pathseq_host.dict"

    shell: "tar -I pigz -xvf {input} -C PathseqDB"

rule decompress_microbe_DB:
    input: f"{db_path}/pathseq_microbe.tar.gz"

    output: f"{db_path}/pathseq_microbe.fa.fai",
            f"{db_path}/pathseq_microbe.fa",
            f"{db_path}/pathseq_microbe.fa.img",
            f"{db_path}/pathseq_microbe.dict"


    shell: "tar -I pigz -xvf {input} -C PathseqDB"

rule decompress_taxonomy_DB:
    input: f"{db_path}/pathseq_taxonomy.tar.gz"

    output: f"{db_path}/pathseq_taxonomy.db"

    shell: "tar -I pigz -xvf {input} -C PathseqDB"


