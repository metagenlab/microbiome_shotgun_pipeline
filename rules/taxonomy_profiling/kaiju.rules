rule all_kaiju:
    input: expand("kaiju/{sample}.tsv",sample=list(read_naming.keys()))

rule kaiju_on_reads:
    conda: pipeline_path + "envs/kaiju.yml"

    input: expand("unmapped/{host_acc}/{sample}_R{rp}.fq",host_acc=config['reference_genome']['filename'],rp=['1','2'],sample=list(read_naming.keys()))

    output: temp("kaiju/{sample}.out")

    threads: 8

    params: nodes=config["nodes_dmp"],db=config["kaiju_database"]

    shell: "kaiju -z {threads} -t {params.nodes} -f {params.db} -i {input[0]} -j {input[1]} -a mem -o {output}"

rule classification_summary:
    conda: pipeline_path + "envs/kaiju.yml"

    input: "kaiju/{sample}.out"

    output: "kaiju/{sample}.tsv"

    params: nodes=config["nodes_dmp"],names=config["names_dmp"]

    shell: "kaiju2table -t {params.nodes} -n {params.names} -r genus -o {output} {input}"

